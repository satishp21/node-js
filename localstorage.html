<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form onsubmit="saveToLocalStorage(event)">
        <label>Name</label>
        <input type="text" name="username" id="usernameInputTag" required>
        <label>Email</label>
        <input type="email" name="emailId" id="emailInputTag" required>
        <label>phonenumber</label>
        <input type="number" name="phonenumber" id="phonenumberInputTag" required>
        <input type="submit" name="submit">
        <ul id="listofitems">
        </ul>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js" ></script>
    <!-- for backend activity -->
    <script>
        function saveToLocalStorage(event) {
            event.preventDefault();
            const name = event.target.username.value;
            const email = event.target.emailId.value;
            const phonenumber = event.target.phonenumber.value;
            const obj = {
                name,
                email,
                phonenumber
            }
            //for backend activity
            axios.post("https://crudcrud.com/api/d1589bd475b7496baabdfe3c51f80896/appointmentdata", obj)
            .then((response) => {
                console.log(response)
            })
            .catch((err) =>{
                console.log(err)
            })
            let data = localStorage.getItem("userList");

            if (data) {
                data = JSON.parse(data);
            } else {
                data = [];
            }
            data.push(obj);

            //localStorage.setItem("userList", JSON.stringify(data))   
            showuseronscreen();
        }
        window.addEventListener("DOMContentLoaded", () =>{
            axios.get("https://crudcrud.com/api/d1589bd475b7496baabdfe3c51f80896/appointmentdata")
                .then((response) =>{
                    console.log(response)
                    for (var i=0; i< response.data.length; i++){
                        showuseronscreen()
                    }
                })
                .catch((error) => {
                    console.log(error)
                })

            
        })

        function showuseronscreen() {
            const parenteliment = document.getElementById("listofitems")
            parenteliment.innerHTML = ""
            const data = JSON.parse(localStorage.getItem("userList") || "[]");

            console.log("showuseronscreen data", data)

            data.map((item) => {
                const childelem = document.createElement("li")
                childelem.textContent = item.name + "-" + item.email + "-" + item.phonenumber

                // creating delete button which deletes data from screen as well as local storage.  

                const deletebutton = document.createElement("input")
                deletebutton.type = "button"
                deletebutton.value = "Delete"
                deletebutton.onclick = () => {
                    localStorage.removeItem("userList")
                    parenteliment.removeChild(childelem)
                }

                //creating edit button just after delete button
                const editbutton = document.createElement("input")
                editbutton.type = "button"
                editbutton.value = "Edit"
                editbutton.onclick = () => {
                    localStorage.removeItem("userList")
                    parenteliment.removeChild(childelem)
                    document.getElementById('usernameInputTag').value = item.name
                    document.getElementById('emailInputTag').value = item.email
                    document.getElementById('phonenumberInputTag').value = item.phonenumber
                }
                childelem.appendChild(deletebutton)
                childelem.appendChild(editbutton)
                parenteliment.appendChild(childelem)
            })
        }

        showuseronscreen();

    </script>
</body>

</html>