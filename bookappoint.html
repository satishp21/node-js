<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form onsubmit="saveToLocalStorage(event)">
        <label>Name</label>
        <input type ="text" name="username" id ="usernameInputTag" required>
        <label>Email</label>
        <input type ="email" name="emailId" id="emailInputTag" required>
        <label>phonenumber</label>
        <input type ="number" name="phonenumber" id ="phonenumberInputTag">
        <input type="submit" name ="submit">
        <ul id ="listofitems">
        </ul>
    </form>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.3/axios.min.js"></script>
    <script>
        function saveToLocalStorage(event){
            event.preventDefault();
            const name=event.target.username.value;
            const email=event.target.emailId.value;
            const phonenumber=event.target.phonenumber.value;

            const obj={
                name,
                email,
                phonenumber
            }

            axios.post("https://crudcrud.com/api/6b49309760414a30b650cc1a1614612f/appointmentData",obj)
                .then((response) => {
                    showuseronscreen(response.data)
                    console.log(response)
                })
                .catch((error) => {
                    console.log(error)
                })
      
        //storing details of multiple users
        //localStorage.setItem(obj.email,JSON.stringify(obj)) comment out to use backebd server crud drud to call data insteart ogf local storage
        //showuseronscreen(obj)
        }
        window.addEventListener("DOMContentLoaded", () => {
            axios.get("https://crudcrud.com/api/6b49309760414a30b650cc1a1614612f/appointmentData")
                .then((response) =>{
                    console.log(response)
                    for(var i=0; i< response.data.length; i++){
                        showuseronscreen(response.data[i])
                    }
                })
                .catch((err) => {
                    console.log(err)
                })

            //const localStorageobj = localStorage;
            //const localStoragekeys = Object.keys(localStorageobj)
        })
        
        function showuseronscreen(obj){
           const parenteliment=document.getElementById("listofitems")
           const childelem = document.createElement("li")
           childelem.textContent = obj.name + "-" + obj.email + "-" + obj.phonenumber
           
           //parenteliment.innerHTML = parenteliment.innerHTML + `<li>${obj.name} - ${obj.email} - ${obj.phonenumber}</li>`

        // creating delete button which deletes data from screen as well as local storage.  

            const deletebutton=document.createElement("input")
            deletebutton.type="button"
            deletebutton.value="Delete"
            deletebutton.onclick = () => {
                localStorage.removeItem(obj.email)
                parenteliment.removeChild(childelem)
                axios.delete(`https://crudcrud.com/api/6b49309760414a30b650cc1a1614612f/appointmentData/${obj._id}`)
                    .catch((error) => {
                        console.log(error)
                    })
            }
        
        //creating edit button just after delete button
            const editbutton=document.createElement("input")
            editbutton.type="button"
            editbutton.value="Edit"
            editbutton.onclick = () => {
                localStorage.removeItem(obj.email)
                parenteliment.removeChild(childelem)
                document.getElementById('usernameInputTag').value=obj.name
                document.getElementById('emailInputTag').value=obj.email
                document.getElementById('phonenumberInputTag').value=obj.phonenumber
                axios.put(`https://crudcrud.com/api/6b49309760414a30b650cc1a1614612f/appointmentData/${obj._id}`)
                    .catch((error) => {
                        console.log(error)
                    })

            }
            childelem.appendChild(deletebutton)
            childelem.appendChild(editbutton)
            parenteliment.appendChild(childelem)
        }

    </script>
</body>
</html>